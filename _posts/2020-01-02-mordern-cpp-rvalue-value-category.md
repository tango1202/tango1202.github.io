---
layout: single
title: "#1. [모던 C++] 우측값과 Value 카테고리(C++11~)"
categories: "mordern-cpp"
tag: ["cpp"]
author_profile: false
sidebar: 
    nav: "docs"
---

# 개요

C++의 STL을 보면 대부분 값 기반 복사/대입이 이루어져 속도 성능이 저하될 수 있습니다. 이런 문제를 해결하고자 C++11 부터 `move()` 연산을 지원하게 되었으며, 우측값과 Value 카테고리에 대한 이해가 있어야 이를 활용할 수 있습니다. 포인터나 참조자도 어려웠습니다만, 우측값과 Value 카테고리는 더욱더 어렵습니다. 하지만 이를 이해하지 않고는 Mordern C++를 활용할 수 없기에 꼭 이해해야만 합니다.

우측값의 컨셉은 다음과 같습니다.

1. 오른쪽 표현식(`a + b`)의 결과 값은 임시 변수임.
2. 임시 변수는 어짜피 버려질 것이므로 굳이 `c`에 복사하지 말고 이동시키면 속도가 조금이라도 빨라짐.

```cpp
int a, b; // a, b 는 좌측값
int c = a + b; // c는 좌측값. a + b 연산 결과는 임시 변수로서 우측값
```

# 왼쪽값(lvalue, left Value)과 우측값(rvalue, right value)

C에서의 정의는 다음과 같습니다.

|항목|내용|
|--|--|
|좌측값|변수처럼 대입시에 왼쪽 또는 오른쪽에 올 수 있는 표현식|
|우측값|일련의 수식처럼 대입시에 왼쪽에만 올 수 있는 표현식|

C++의 정의는 다음과 같습니다.

|항목|내용|
|--|--|
|좌측값|변수처럼 어떠한 메모리 위치를 가리키며 `&`로 그 위치를 참조할 수 있는 표현식|
|우측값|좌측값이 아닌 값|

다음처럼 `&`연산이 불가능하면 우측값입니다.

```cpp
int a = 0; 
int* ptr1 = &a; // a는 &로 위치 참조가 되므로 좌측값
int* ptr2 = &0; // (X) 컴파일 오류. 상수 0은 & 위치 참조가 안되므로 우측값
int b = &(a + 10); // (X) 컴파일 오류. 수식 (a + 10)은 & 위치 참조가 안되므로 우측값
```

혹은 참조자로 저장할 수 없으면 우측값입니다.

```cpp
int a = 0; 
int& ptr1 = a; // a는 &로 참조되므로 좌측값
int& ptr2 = 0; // (X) 컴파일 오류. 상수 0은 &로 참조가 안되므로 우측값
int& b = (a + 10); // (X) 컴파일 오류. 수식 (a + 10)은 & 참조가 안되므로 우측값
```

# Value 카테고리

C++에서는 표현식의 값들에 대해서 식별자가 있는지, `move()` 가 지원되는지에 따라, 값을 다음처럼 분류했습니다.

![image](https://github.com/tango1202/tango1202.github.io/assets/133472501/f8e1a357-ab67-4186-8cad-c5fdcda930ef)

|항목|내용|
|--|--|
|`lvalue`(left value)|좌측값으로서 변수와 같이 식별자가 있는 항목입니다. 다른곳에서 참조할 수도 있기에 이동 연산이 지원되지 않습니다.(변수, 데이터 멤버의 이름, 함수, `&`포인터 연산, 전위 증감 연산, 문자열 상수등)<br/>대입문의 좌측에 올 수 있고, `&`로 주소를 얻어올 수 있으며, 표현식이 끝나더라도 존재합니다.|
|`xvalue`(expiring value)|`lvalue`나 `prvalue`를 `move()`할때 순간적으로 관리되는 값으로서 만료되어 가는 값입니다. 해당 주소로 접근했을때 값이 있을 수도 있고, 없을 수도 있습니다. 컴파일러만 사용하므로 `&`로 주소를 얻을 수 없으며, 표현식이 끝나면 소멸됩니다.|
|`prvalue`(pure rvalue)|순수한 rvalue로서 식별자가 없는 임시 개체나 수식들입니다.어짜피 임시로 생성된 것이므로 맘편히 삭제해도 되는 것들이며, 이동 연산이 지원됩니다.(수식, 후위 증감 연산, 문자열 상수를 제외한 상수)<br/>대입문의 우측에 올 수 있고, `&`로 주소를 얻어올 수 없으며, 표현식이 끝나면 소멸됩니다.|
|`glvalue`(generalized lvalue)|`xvalue`와 `lvalue`를 통칭합니다.| 
|`rvalue`(right value)|`xvalue`와 `prvalue`를 통칭합니다.|  

# 우측값 참조

# 참조 전달
Forwarding references

https://en.cppreference.com/w/cpp/language/reference